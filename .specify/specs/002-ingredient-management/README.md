# Spec 002: 食材管理

**Spec ID**: 002
**功能名称**: 食材管理
**优先级**: P0
**状态**: ✅ 已实现
**创建日期**: 2026-02-15
**最后更新**: 2026-02-15

---

## 文档列表

| 文档 | 描述 | 字符数 |
|------|------|--------|
| [spec.md](./spec.md) | 需求规范（What + Why） | 2,913 |
| [plan.md](./plan.md) | 技术方案（技术栈 + 架构） | 16,954 |
| [data-model.md](./data-model.md) | 数据模型（实体定义） | ⬜ 待创建 |
| [tasks.md](./tasks.md) | 任务清单（实现步骤） | 5,825 |
| [research.md](./research.md) | 技术调研（选型 + 问题） | ⬜ 待创建 |
| [README.md](./README.md) | 文档总结 | - |

**总计**: 25,692 字符（不含未创建文档）

---

## 核心内容

### What（做什么）

**核心功能**:
1. **食材库管理**: 添加、编辑、删除、搜索食材
2. **储藏室库存**: 添加、编辑、删除库存，按位置查看
3. **保质期管理**: 查看即将到期的食材（N天内）、查看已过期的食材
4. **存储位置管理**: 按冷藏、冷冻、常温筛选，统计各位置数量

### Why（为什么）

**对用户的价值**:
- 统一管理食材，不再散落各处
- 查看库存，决定做什么菜
- 保质期提醒，减少浪费
- 避免重复购买

**对产品的价值**:
- 核心功能，是用户使用应用的重要原因
- 为智能推荐功能提供数据
- 为购物清单功能提供数据
- 提高用户粘性

---

## 技术实现

### 技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| Kotlin | 1.9+ | 开发语言 |
| Jetpack Compose | 1.5+ | UI 框架 |
| Room | 2.6+ | 本地数据库 |
| Coroutines | 1.7+ | 异步处理 |
| Flow | Kotlin | 数据流 |

### 架构设计

```
┌─────────────────────────────────────────────────────┐
│                    Presentation Layer                       │
│  ┌──────────────┐  ┌──────────────┐  ┌────────────────┐   │
│  │   Screens    │  │  ViewModels  │  │  Navigation    │   │
│  │  (Compose)   │◄─┤   (State)    │─►│    (Graph)     │   │
│  └──────────────┘  └──────────────┘  └────────────────┘   │
└─────────────────────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────┐
│                     Domain Layer                            │
│  ┌──────────────┐  ┌──────────────┐  ┌────────────────┐   │
│  │ Repositories │  │   Mappers    │  │   Use Cases    │   │
│  │  (Abstract)  │  │              │  │  (Optional)    │   │
│  └──────────────┘  └──────────────┘  └────────────────┘   │
└─────────────────────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────┐
│                        Data Layer                           │
│  ┌──────────────┐  ┌──────────────┐  ┌────────────────┐   │
│  │  Room DB     │  │     DAOs     │  │   Entities     │   │
│  │  (SQLite)   │◄─┤  (Queries)   │─►│   (Models)     │   │
│  └──────────────┘  └──────────────┘  └────────────────┘   │
└─────────────────────────────────────────────────────┘
```

---

## 数据模型

### 核心实体

1. **Ingredient（食材）**
   - id, name, unit, category, shelfLifeDays, iconUrl

2. **PantryItem（库存）**
   - id, ingredientId, name, quantity, unit, purchaseDate, expiryDate, storageLocation, notes

3. **StorageLocation（存储位置）**
   - FRIDGE（冷藏）、FREEZER（冷冻）、PANTRY（常温）、OTHER（其他）

4. **IngredientCategory（食材分类）**
   - VEGETABLE（蔬菜）、FRUIT（水果）、MEAT（肉类）、SEAFOOD（海鲜）、DAIRY（乳制品）、GRAIN（谷物）、SPICE（调料）、SAUCE（酱料）、OTHER（其他）

---

## 实现状态

### 已完成（✅）

#### 数据层
- [x] Ingredient Entity
- [x] PantryItem Entity
- [x] IngredientDao（33 个方法）
- [x] IngredientRepository（14 个方法）

#### 业务逻辑层
- [x] IngredientViewModel（7 个方法）

#### 表现层
- [x] IngredientScreen
- [x] IngredientDetailScreen
- [x] PantryScreen

#### 测试
- [x] IngredientRepositoryTest（48 个测试）

---

## 验收标准

### 功能验收

- [x] 可以添加食材
- [x] 可以编辑食材
- [x] 可以删除食材
- [x] 可以搜索食材
- [x] 可以添加库存
- [x] 可以编辑库存
- [x] 可以删除库存
- [x] 可以查看即将到期的食材
- [x] 可以查看已过期的食材
- [x] 可以按存储位置筛选

### 性能验收

- [x] 食材列表加载时间 < 1s
- [x] 食材搜索响应时间 < 1s
- [x] 库存列表加载时间 < 1s

### 测试验收

- [x] 单元测试覆盖率 ≥ 70%
- [x] 48 个单元测试全部通过

---

## 已知问题和优化方向

### 已知问题

1. **智能推荐功能**
   - 当前：返回空列表
   - 未来：实现基于库存的菜谱推荐算法

2. **食材单位标准化**
   - 当前：自由输入单位
   - 未来：提供标准单位列表

3. **批量操作**
   - 当前：逐个添加食材
   - 未来：支持批量导入

---

## 参考资料

- [spec.md](./spec.md)
- [plan.md](./plan.md)
- [tasks.md](./tasks.md)
- [REQUIREMENTS.md](../../../docs/REQUIREMENTS.md)
- [ARCHITECTURE.md](../../../docs/ARCHITECTURE.md)
- [Constitution](../memory/constitution.md)

---

**文档版本**: 1.0
**创建日期**: 2026-02-15
**最后更新**: 2026-02-15
**负责人**: Jude 🦞
