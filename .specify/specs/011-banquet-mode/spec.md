# Spec: 菜谱管理基础功能

**Spec ID**: 001
**功能名称**: 菜谱管理基础功能
**优先级**: P0
**状态**: ✅ 已实现
**创建日期**: 2026-02-15
**最后更新**: 2026-02-15

---

## What

### 功能描述

菜谱管理是 HomePantry 的核心功能，允许用户添加、编辑、删除、搜索和收藏菜谱。每个菜谱包含名称、描述、图片、烹饪时间、份量、难度、分类和制作步骤等信息。

### 核心功能

1. **添加菜谱**
   - 完整录入菜谱信息（菜名、描述、图片、时间、份量、难度）
   - 添加食材清单（食材名称、用量、单位）
   - 添加制作步骤（步骤描述、配图、时长）
   - 选择分类和标签

2. **编辑菜谱**
   - 修改菜谱基本信息
   - 添加/删除/修改食材
   - 添加/删除/修改步骤
   - 更新分类和标签

3. **删除菜谱**
   - 删除单个菜谱
   - 删除菜谱时同时删除关联的食材和步骤

4. **搜索菜谱**
   - 按菜名搜索（模糊匹配）
   - 按分类筛选
   - 按难度筛选
   - 按烹饪时间筛选
   - 按份量筛选

5. **收藏菜谱**
   - 收藏/取消收藏
   - 查看收藏列表
   - 调整收藏顺序

6. **查看菜谱详情**
   - 显示菜谱完整信息
   - 显示食材清单
   - 显示制作步骤
   - 显示制作历史和评分

### 用户场景

#### 场景1：添加新菜谱

**触发条件**: 用户发现了一个新菜谱，想要保存到应用中

**用户目标**: 完整录入菜谱信息，方便日后查找和制作

**当前痛点**: 每次都要手动记录在笔记本或拍照，难以整理和搜索

**解决方案**:
1. 点击"添加菜谱"按钮
2. 录入基本信息：
   - 菜名（必填）
   - 描述（选填）
   - 烹饪时间（拖动选择）
   - 份量（拖动选择）
   - 难度（1-5星）
   - 分类（必选）
   - 标签（多选）
3. 上传图片（最多9张）
4. 添加食材清单（食材名称、用量、单位）
5. 添加制作步骤（步骤描述、配图、时长）
6. 点击保存

**成功标准**:
- 菜谱成功保存到数据库
- 可以在菜谱列表中找到该菜谱
- 菜谱信息完整、准确

#### 场景2：搜索菜谱

**触发条件**: 用户想做饭，但不知道做什么

**用户目标**: 快速找到想做的菜谱

**当前痛点**: 菜谱太多，难以快速找到合适的

**解决方案**:
1. 进入菜谱列表页面
2. 使用搜索框输入菜名
3. 或使用筛选条件（分类、难度、时间）
4. 浏览搜索结果
5. 点击菜谱查看详情

**成功标准**:
- 搜索结果准确
- 搜索速度快（< 1s）
- 可以快速切换筛选条件

#### 场景3：收藏菜谱

**触发条件**: 用户喜欢某个菜谱，想经常制作

**用户目标**: 将菜谱标记为收藏，方便快速访问

**当前痛点**: 需要搜索才能找到喜欢的菜谱

**解决方案**:
1. 在菜谱详情页点击"收藏"按钮
2. 菜谱被标记为收藏
3. 进入"我的收藏"页面查看收藏列表

**成功标准**:
- 收藏状态正确切换
- 收藏列表按顺序显示
- 可以调整收藏顺序

---

## Why

### 业务价值

**对用户的价值**:
- 统一管理菜谱，不再散落各处
- 快速搜索和筛选，节省时间
- 收藏喜欢的菜谱，方便访问
- 记录制作心得，持续改进

**对产品的价值**:
- 核心功能，是用户使用应用的主要原因
- 为其他功能（智能推荐、菜单规划、购物清单）提供基础数据
- 高频使用功能，提高用户粘性

### 问题解决

**解决的核心问题**:
1. 菜谱散落各处，难以管理
2. 菜谱太多，难以快速找到
3. 制作心得无处记录
4. 没有收藏功能，喜欢的菜谱难以快速访问

**不解决的问题**:
- 不自动推荐菜谱（由智能推荐功能解决）
- 不自动生成购物清单（由购物清单功能解决）
- 不记录营养信息（由营养分析功能解决）

### 成功指标

**功能性指标**:
- 菜谱添加成功率: ≥ 99%
- 菜谱搜索准确率: ≥ 95%
- 收藏功能正常使用率: ≥ 90%

**性能指标**:
- 菜谱列表加载时间: < 1s
- 菜谱搜索响应时间: < 1s
- 菜谱详情加载时间: < 1s

**用户体验指标**:
- 菜谱添加完成率: ≥ 80%
- 菜谱搜索使用率: ≥ 60%
- 菜谱收藏使用率: ≥ 40%

---

## User Stories

### US-001: 作为用户，我想要添加新菜谱，以便保存我发现的菜谱

**验收标准**:
- [ ] 可以录入菜名、描述、烹饪时间、份量、难度
- [ ] 可以上传最多9张图片
- [ ] 可以添加食材清单（食材名称、用量、单位）
- [ ] 可以添加制作步骤（步骤描述、配图、时长）
- [ ] 可以选择分类和标签
- [ ] 菜谱成功保存后，可以在菜谱列表中找到
- [ ] 菜谱信息完整、准确

### US-002: 作为用户，我想要编辑菜谱，以便修改菜谱信息或制作心得

**验收标准**:
- [ ] 可以修改菜谱基本信息
- [ ] 可以添加/删除/修改食材
- [ ] 可以添加/删除/修改步骤
- [ ] 可以更新分类和标签
- [ ] 修改后菜谱信息正确更新

### US-003: 作为用户，我想要删除菜谱，以便移除不再需要的菜谱

**验收标准**:
- [ ] 可以删除单个菜谱
- [ ] 删除菜谱时同时删除关联的食材和步骤
- [ ] 删除操作有确认提示
- [ ] 删除后菜谱不再显示在列表中

### US-004: 作为用户，我想要搜索菜谱，以便快速找到想做的菜谱

**验收标准**:
- [ ] 可以按菜名搜索（模糊匹配）
- [ ] 可以按分类筛选
- [ ] 可以按难度筛选
- [ ] 可以按烹饪时间筛选
- [ ] 可以按份量筛选
- [ ] 搜索结果准确
- [ ] 搜索响应时间 < 1s

### US-005: 作为用户，我想要收藏菜谱，以便快速访问喜欢的菜谱

**验收标准**:
- [ ] 可以收藏/取消收藏菜谱
- [ ] 可以查看收藏列表
- [ ] 可以调整收藏顺序
- [ ] 收藏状态正确切换

### US-006: 作为用户，我想要查看菜谱详情，以便了解完整的菜谱信息

**验收标准**:
- [ ] 显示菜谱基本信息
- [ ] 显示食材清单
- [ ] 显示制作步骤
- [ ] 显示制作历史和评分
- [ ] 详情加载时间 < 1s

---

## Non-Functional Requirements

### 性能

| 指标 | 要求 | 说明 |
|------|------|------|
| 菜谱列表加载 | < 1s | 1000个菜谱以内 |
| 菜谱搜索响应 | < 1s | 模糊匹配 |
| 菜谱详情加载 | < 1s | 包含食材和步骤 |
| 菜谱保存 | < 2s | 包含图片上传 |
| 菜谱删除 | < 1s | 包含关联数据删除 |

### 可用性

| 指标 | 要求 | 说明 |
|------|------|------|
| 添加菜谱成功率 | ≥ 99% | 无数据丢失 |
| 搜索准确率 | ≥ 95% | 模糊匹配准确度 |
| 收藏功能可用率 | ≥ 90% | 功能正常工作 |
| 菜谱加载成功率 | ≥ 99% | 无加载失败 |

### 兼容性

| 平台 | 最低版本 | 说明 |
|------|---------|------|
| Android | API 24 (Android 7.0) | 最小支持 |
| 屏幕尺寸 | 4英寸+ | 适配不同屏幕 |
| 屏幕密度 | mdpi - xxxhdpi | 适配不同密度 |

### 可维护性

| 指标 | 要求 | 说明 |
|------|------|------|
| 代码覆盖率 | ≥ 70% | 单元测试覆盖率 |
| 文档完整性 | 100% | 所有函数有注释 |
| 代码复杂度 | 中等 | 圈复杂度 < 10 |

---

## Constraints

### 技术约束

- **编程语言**: Kotlin 1.9+
- **UI 框架**: Jetpack Compose 1.5+
- **数据库**: Room 2.6+
- **异步处理**: Coroutines + Flow
- **最低支持**: Android API 24

### 业务约束

- **菜谱数量**: 单个用户最多 10,000 个菜谱
- **图片数量**: 单个菜谱最多 9 张图片
- **食材数量**: 单个菜谱最多 100 个食材
- **步骤数量**: 单个菜谱最多 50 个步骤

### 用户约束

- **菜名长度**: 2-50 字符
- **烹饪时间**: 1-999 分钟
- **份量**: 1-100 人份
- **难度**: 1-5 星

---

## Dependencies

### 依赖的其他功能

- **分类管理**: 菜谱需要关联分类（由分类管理功能提供）
- **标签系统**: 菜谱可以关联标签（由标签系统提供）
- **图片存储**: 菜谱图片需要存储服务（由存储系统提供）

### 被依赖的功能

- **智能推荐**: 基于菜谱数据推荐菜谱
- **菜单规划**: 将菜谱添加到菜单
- **购物清单**: 根据菜谱生成购物清单
- **制作记录**: 记录菜谱制作历史

---

## Risks

### 技术风险

| 风险 | 可能性 | 影响 | 缓解措施 |
|------|--------|------|----------|
| 大量菜谱导致性能下降 | 中 | 高 | 使用索引、分页加载、缓存 |
| 图片上传失败 | 低 | 中 | 重试机制、本地缓存 |
| 数据库迁移失败 | 低 | 高 | 完善的测试、迁移脚本 |

### 业务风险

| 风险 | 可能性 | 影响 | 缓解措施 |
|------|--------|------|----------|
| 用户不添加菜谱 | 中 | 高 | 优化添加流程、提供模板 |
| 用户找不到菜谱 | 中 | 中 | 优化搜索算法、提供筛选 |
| 用户不使用收藏功能 | 低 | 低 | 提示收藏功能、优化体验 |

---

## Out of Scope

### 不在本次实现的功能

- [ ] AI 自动识别菜谱（从图片或链接）
- [ ] 菜谱分享和导入
- [ ] 菜谱版本管理
- [ ] 菜谱协作（家庭成员共享）
- [ ] 营养信息记录
- [ ] 菜谱评价和评论（除了个人评分）

### 未来可能的功能

- AI 自动识别菜谱（优先级 P2）
- 菜谱分享和导入（优先级 P2）
- 菜谱版本管理（优先级 P3）
- 菜谱协作（优先级 P3）

---

## Notes

### 设计决策

1. **为什么使用 Room 数据库？**
   - Room 是 Android 官方推荐的数据库解决方案
   - 支持 Flow 实时数据更新
   - 编译时 SQL 验证，减少运行时错误
   - 支持复杂的数据库操作

2. **为什么使用 Jetpack Compose？**
   - Compose 是 Android 的现代 UI 框架
   - 声明式 UI，代码更简洁
   - 强大的预览功能，提高开发效率
   - 原生支持 Material Design 3

3. **为什么使用 Flow 而不是 LiveData？**
   - Flow 是 Kotlin 的官方响应式 API
   - 支持更多的操作符
   - 可以跨层传递
   - 更灵活的数据流控制

### 已知问题

1. **大量菜谱时的性能问题**
   - 当前解决方案：使用索引、分页加载
   - 未来优化：引入缓存、预加载

2. **图片上传的失败重试**
   - 当前解决方案：本地缓存图片
   - 未来优化：实现完善的失败重试机制

---

## References

- [REQUIREMENTS.md](../../../docs/REQUIREMENTS.md)
- [ARCHITECTURE.md](../../../docs/ARCHITECTURE.md)
- [DEVELOPMENT.md](../../../docs/DEVELOPMENT.md)
- [TEST_REPORT.md](../../../docs/TEST_REPORT.md)

---

**文档版本**: 1.0
**创建日期**: 2026-02-15
**最后更新**: 2026-02-15
**负责人**: Jude 🦞
