# Spec: 营养分析与数据统计

**Spec ID**: 015
**功能名称**: 营养分析与数据统计
**优先级**: P1
**状态**: ✅ 已实现
**创建日期**: 2026-02-15
**最后更新**: 2026-02-20

---

## What

### 功能描述

营养分析与数据统计功能帮助用户了解自己的饮食情况，提供营养分析报告、健康建议，以及数据导出功能。

### 核心功能

#### 1. 单日营养分析
- 分析当日各餐的营养摄入
- 计算总热量、蛋白质、脂肪、碳水化合物、膳食纤维
- 评估营养均衡度（评分）
- 识别营养问题（不足/过高）

#### 2. 周营养分析
- 分析一周的营养趋势
- 计算平均每日营养摄入
- 生成周营养报告
- 提供改进建议

#### 3. 营养建议
- 根据健康目标提供个性化建议
- 支持多种健康目标：减肥、增肌、健康饮食
- 提供具体的饮食调整建议

#### 4. 与推荐摄入量对比
- 根据性别、年龄、活动水平计算推荐摄入量
- 对比实际摄入与推荐摄入
- 显示差异和改进建议

#### 5. 数据导出
- 导出菜谱数据为 JSON 格式
- 支持批量导出
- 支持导入菜谱数据

### 用户场景

#### 场景1：查看今日营养情况

**触发条件**: 用户完成一天的饮食规划或记录

**用户目标**: 了解今日营养摄入是否均衡

**当前痛点**: 不知道今天吃得是否健康

**解决方案**:
1. 打开营养分析页面
2. 选择"今日营养"
3. 查看各餐营养详情
4. 查看总营养和评分
5. 阅读营养建议

**成功标准**:
- 正确计算营养数据
- 提供有用的营养建议
- 界面清晰易懂

#### 场景2：对比健康目标

**触发条件**: 用户想减肥或增肌

**用户目标**: 了解当前饮食是否符合健康目标

**当前痛点**: 不知道需要调整哪些食物

**解决方案**:
1. 打开营养对比页面
2. 设置健康目标（减肥/增肌/保持）
3. 输入个人信息（性别、年龄、活动水平）
4. 查看实际与推荐的对比
5. 阅读改进建议

**成功标准**:
- 推荐摄入量准确
- 对比结果清晰
- 建议具体可行

#### 场景3：导出菜谱数据

**触发条件**: 用户想备份或分享菜谱

**用户目标**: 将菜谱导出为文件

**当前痛点**: 无法方便地备份或分享菜谱

**解决方案**:
1. 选择要导出的菜谱
2. 点击导出按钮
3. 选择保存位置
4. 等待导出完成
5. 确认导出成功

**成功标准**:
- 导出数据完整
- 导出速度合理
- 文件格式正确

---

## Why

### 业务价值

**对用户的价值**:
- 了解饮食营养情况
- 获得个性化营养建议
- 实现健康饮食目标
- 方便备份和分享菜谱

**对产品的价值**:
- 提升用户粘性
- 提供数据支持
- 增加应用功能完整性

### 问题解决

**解决的核心问题**:
1. 不知道吃得是否健康
2. 不知道如何调整饮食
3. 没有数据备份能力

**不解决的问题**:
- 不自动记录食物摄入（需要用户手动规划）
- 不提供专业的医疗建议（仅供参考）

### 成功指标

**功能性指标**:
- 营养计算准确率: ≥ 95%
- 导出成功率: ≥ 99%
- 导入成功率: ≥ 99%

**性能指标**:
- 单日营养分析: < 1s
- 周营养分析: < 2s
- 数据导出: < 5s（100个菜谱）

**用户体验指标**:
- 营养分析使用率: ≥ 30%
- 数据导出使用率: ≥ 10%
- 用户满意度: ≥ 4.0/5.0

---

## User Stories

### US-015-1: 作为用户，我想要查看今日营养，以便了解吃得是否健康

**验收标准**:
- [ ] 可以查看今日各餐营养详情
- [ ] 可以查看总营养和评分
- [ ] 可以查看营养问题和警告
- [ ] 可以获得营养建议
- [ ] 营养计算准确

### US-015-2: 作为用户，我想要对比推荐摄入量，以便了解是否达标

**验收标准**:
- [ ] 可以设置个人信息（性别、年龄、活动水平）
- [ ] 可以选择健康目标
- [ ] 可以查看实际与推荐的对比
- [ ] 可以查看差异和改进建议
- [ ] 推荐摄入量准确

### US-015-3: 作为用户，我想要导出菜谱数据，以便备份和分享

**验收标准**:
- [ ] 可以选择要导出的菜谱
- [ ] 可以选择保存位置
- [ ] 导出数据完整
- [ ] 导出速度合理
- [ ] 支持批量导出

### US-015-4: 作为用户，我想要导入菜谱数据，以便恢复或迁移菜谱

**验收标准**:
- [ ] 可以选择要导入的文件
- [ ] 可以预览导入内容
- [ ] 可以选择导入哪些菜谱
- [ ] 导入成功率高
- [ ] 重复菜谱可以跳过

---

## Non-Functional Requirements

### 性能

| 指标 | 要求 | 说明 |
|------|------|------|
| 单日营养分析 | < 1s | 包含所有计算 |
| 周营养分析 | < 2s | 包含趋势分析 |
| 数据导出 | < 5s | 100个菜谱 |
| 数据导入 | < 5s | 100个菜谱 |

### 可用性

| 指标 | 要求 | 说明 |
|------|------|------|
| 营养计算准确率 | ≥ 95% | 与实际摄入误差 < 5% |
| 导出成功率 | ≥ 99% | 无数据丢失 |
| 导入成功率 | ≥ 99% | 无数据损坏 |

### 兼容性

| 平台 | 最低版本 | 说明 |
|------|---------|------|
| Android | API 24 (Android 7.0) | 最小支持 |
| 文件格式 | JSON | 跨平台兼容 |

### 可维护性

| 指标 | 要求 | 说明 |
|------|------|------|
| 代码覆盖率 | ≥ 70% | 单元测试覆盖率 |
| 文档完整性 | 100% | 所有函数有注释 |

---

## Constraints

### 技术约束

- **编程语言**: Kotlin 1.9+
- **数据库**: Room 2.6+
- **异步处理**: Coroutines + Flow
- **JSON 序列化**: Gson
- **最低支持**: Android API 24

### 业务约束

- **菜谱数量**: 单次导出最多 1000 个菜谱
- **营养数据**: 基于用户输入，可能不完整
- **健康建议**: 仅供参考，不替代专业医疗建议

### 用户约束

- **性别**: 男性/女性
- **年龄**: 18-99 岁
- **活动水平**: 久坐/轻度/中度/活跃/非常活跃

---

## Dependencies

### 依赖的其他功能

- **菜谱管理**: 需要菜谱数据（由 Spec 001 提供）
- **餐食计划**: 需要餐食计划数据（由 Spec 003 提供）
- **营养信息**: 需要营养信息数据（由 Spec 010 提供）

### 被依赖的功能

- **数据统计报告**: 提供营养数据支持
- **健康建议**: 提供营养分析结果

---

## Risks

### 技术风险

| 风险 | 可能性 | 影响 | 缓解措施 |
|------|--------|------|----------|
| 营养数据不完整 | 高 | 中 | 提供默认值，提示用户补充 |
| 导入格式错误 | 中 | 中 | 严格验证，提供错误提示 |
| 大数据量导出慢 | 低 | 低 | 分批导出，显示进度 |

### 业务风险

| 风险 | 可能性 | 影响 | 缓解措施 |
|------|--------|------|----------|
| 用户不使用营养分析 | 中 | 低 | 简化界面，提供默认设置 |
| 用户不信任计算结果 | 低 | 中 | 说明数据来源，提供参考标准 |

---

## Out of Scope

### 不在本次实现的功能

- [ ] AI 自动识别食物
- [ ] 图表和可视化展示（饼图、折线图等）
- [ ] 社交分享功能
- [ ] 云端同步
- [ ] 多人协作

### 未来可能的功能

- 营养趋势图表（优先级 P2）
- 饮食习惯分析（优先级 P2）
- AI 智能食谱推荐（优先级 P3）

---

## Notes

### 设计决策

1. **为什么使用营养评分系统？**
   - 将复杂的营养数据简化为易于理解的分数
   - 帮助用户快速了解饮食质量

2. **为什么提供健康目标选择？**
   - 不同健康目标有不同的营养需求
   - 个性化建议更有用

3. **为什么使用 JSON 格式导出？**
   - 人类可读，易于编辑
   - 跨平台兼容
   - 易于扩展

### 已知问题

1. **营养数据不完整**
   - 当前解决方案：提供默认值
   - 未来优化：AI 自动估算，集成外部营养数据库

2. **导入格式错误**
   - 当前解决方案：严格验证
   - 未来优化：提供修复工具，自动纠错

---

## References

- [REQUIREMENTS.md](../../../docs/REQUIREMENTS.md)
- [ARCHITECTURE.md](../../../docs/ARCHITECTURE.md)
- [NutritionAnalyzer.kt](../../../android/app/src/main/java/com/homepantry/data/nutrition/NutritionAnalyzer.kt)
- [RecipeExporter.kt](../../../android/app/src/main/java/com/homepantry/data/export/RecipeExporter.kt)

---

**文档版本**: 1.0
**创建日期**: 2026-02-15
**最后更新**: 2026-02-20
**负责人**: Jude 🦞
