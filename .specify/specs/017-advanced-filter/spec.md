# Spec: 高级筛选

**Spec ID**: 017
**功能名称**: 高级筛选
**优先级**: P1
**状态**: 🚧 规划中
**创建日期**: 2026-02-20
**最后更新**: 2026-02-20

---

## What

### 功能描述

高级筛选功能允许用户按多个条件筛选菜谱，提供更精确的搜索结果。

### 核心功能

#### 1. 按烹饪时间筛选

**筛选条件**:
- 15 分钟以内（快手菜）
- 15-30 分钟
- 30-60 分钟
- 60 分钟以上

#### 2. 按难度筛选

**筛选条件**:
- 简单（EASY）
- 中等（MEDIUM）
- 困难（HARD）

#### 3. 按食材筛选

**筛选条件**:
- 包含特定食材
- 排除特定食材
- 只显示能做的菜谱（基于现有食材）

#### 4. 按分类筛选

**筛选条件**:
- 按菜系分类（川菜、粤菜、湘菜等）
- 按类型分类（家常菜、快手菜、硬菜、汤品）

#### 5. 组合筛选

**筛选逻辑**:
- 支持多个条件组合
- 条件之间是 AND 关系
- 实时更新筛选结果

### 用户场景

#### 场景1：找快手菜

**触发条件**: 用户只想花 15 分钟做菜

**用户目标**: 快速找到 15 分钟以内的简单菜谱

**当前痛点**: 搜索结果太多，需要逐个查看

**解决方案**:
1. 进入菜谱列表页面
2. 点击"筛选"按钮
3. 选择"15 分钟以内"
4. 选择"简单"
5. 查看筛选结果

**成功标准**:
- 筛选结果只包含 15 分钟以内且简单的菜谱
- 筛选响应时间 < 500ms
- 筛选结果准确

#### 场景2：用现有食材做菜

**触发条件**: 用户打开冰箱，发现有鸡蛋、番茄、青椒

**用户目标**: 找到用这些食材能做的菜谱

**当前痛点**: 需要逐个查看菜谱的食材清单

**解决方案**:
1. 进入菜谱列表页面
2. 点击"筛选"按钮
3. 选择"使用现有食材"
4. 勾选：鸡蛋、番茄、青椒
5. 查看筛选结果

**成功标准**:
- 筛选结果只包含能做的菜谱
- 按匹配度排序
- 筛选响应时间 < 1s

#### 场景3：找特定菜系的菜

**触发条件**: 用户想吃川菜

**用户目标**: 快速找到所有川菜

**当前痛点**: 需要搜索"川菜"，可能包含其他菜系

**解决方案**:
1. 进入菜谱列表页面
2. 点击"筛选"按钮
3. 选择分类"川菜"
4. 查看筛选结果

**成功标准**:
- 筛选结果只包含川菜
- 筛选响应时间 < 500ms
- 筛选结果完整

---

## Why

### 业务价值

**对用户的价值**:
- 更精确的搜索结果
- 节省查找时间
- 提升用户体验

**对产品的价值**:
- 提升搜索功能的使用率
- 增加用户粘性
- 为个性化推荐提供数据支持

### 问题解决

**解决的核心问题**:
1. 搜索结果太多，难以快速找到目标菜谱
2. 无法按特定条件精确筛选
3. 无法基于现有食材找到能做的菜谱

**不解决的问题**:
- 不自动推荐菜谱（由智能推荐功能解决）
- 不提供食材管理（由食材管理功能解决）

### 成功指标

**功能性指标**:
- 筛选响应时间: < 500ms
- 筛选准确率: ≥ 98%
- 组合筛选成功率: ≥ 95%

**性能指标**:
- 1000 个菜谱筛选: < 500ms
- 10000 个菜谱筛选: < 1s

**用户体验指标**:
- 筛选功能使用率: ≥ 50%
- 筛选结果满意度: ≥ 4.0/5.0

---

## User Stories

### US-017-1: 作为用户，我想要按烹饪时间筛选菜谱，以便快速找到快手菜

**验收标准**:
- [ ] 可以选择烹饪时间范围（<15、15-30、30-60、>60 分钟）
- [ ] 可以选择多个时间范围
- [ ] 筛选结果准确
- [ ] 筛选响应时间 < 500ms

### US-017-2: 作为用户，我想要按难度筛选菜谱，以便找到适合自己水平的菜谱

**验收标准**:
- [ ] 可以选择难度（简单、中等、困难）
- [ ] 可以选择多个难度
- [ ] 筛选结果准确
- [ ] 筛选响应时间 < 500ms

### US-017-3: 作为用户，我想要按食材筛选菜谱，以便找到用现有食材能做的菜谱

**验收标准**:
- [ ] 可以选择包含的食材
- [ ] 可以选择排除的食材
- [ ] 可以选择"使用现有食材"
- [ ] 筛选结果准确
- [ ] 筛选结果按匹配度排序
- [ ] 筛选响应时间 < 1s

### US-017-4: 作为用户，我想要按分类筛选菜谱，以便快速找到特定菜系的菜谱

**验收标准**:
- [ ] 可以选择菜系分类
- [ ] 可以选择多个分类
- [ ] 筛选结果准确
- [ ] 筛选响应时间 < 500ms

### US-017-5: 作为用户，我想要组合筛选条件，以便得到更精确的结果

**验收标准**:
- [ ] 可以组合多个筛选条件
- [ ] 条件之间是 AND 关系
- [ ] 实时更新筛选结果
- [ ] 筛选响应时间 < 500ms

---

## Non-Functional Requirements

### 性能

| 指标 | 要求 | 说明 |
|------|------|------|
| 筛选响应时间 | < 500ms | 单个条件 |
| 筛选响应时间 | < 1s | 组合条件（食材） |
| 大数据量筛选 | < 1s | 10000 个菜谱 |
| 内存占用 | < 100MB | 筛选操作 |

### 可用性

| 指标 | 要求 | 说明 |
|------|------|------|
| 筛选准确率 | ≥ 98% | 与手动对比 |
| 组合筛选成功率 | ≥ 95% | 多条件组合 |
| 筛选响应时间 | < 500ms | 大部分情况下 |

### 兼容性

| 平台 | 最低版本 | 说明 |
|------|---------|------|
| Android | API 24 (Android 7.0) | 最小支持 |

---

## Constraints

### 技术约束

- **编程语言**: Kotlin 1.9+
- **数据库**: Room 2.6+
- **异步处理**: Coroutines + Flow
- **最低支持**: Android API 24

### 业务约束

- **筛选条件数量**: 单次筛选最多 10 个条件
- **食材数量**: 单次筛选最多选择 20 个食材
- **分类数量**: 单次筛选最多选择 5 个分类

---

## Dependencies

### 依赖的其他功能

- **菜谱管理** (Spec 001): 需要菜谱数据
- **食材管理** (Spec 002): 需要食材数据
- **分类管理** (Spec 001 部分实现): 需要分类数据

### 被依赖的功能

- **智能推荐**: 基于筛选行为优化推荐算法
- **菜单规划**: 从筛选结果快速添加到计划

---

## Out of Scope

### 不在本次实现的功能

- [ ] AI 自动识别食材
- [ ] 语音搜索
- [ ] 图像搜索
- [ ] 保存筛选条件为预设

### 未来可能的功能

- 保存筛选条件为预设（优先级 P2）
- 语音搜索（优先级 P3）
- 图像搜索（优先级 P3）

---

## Notes

### 设计决策

1. **为什么使用 Room 的 LIKE 查询进行食材筛选？**
   - Room 对 LIKE 查询有良好支持
   - 可以使用 `%` 通配符
   - 性能足够好（< 1s）

2. **为什么组合筛选使用 AND 关系？**
   - 用户体验更直观
   - 符合大多数筛选器的预期
   - 实现简单

3. **为什么实时更新筛选结果？**
   - 提升用户体验
   - 可以立即看到筛选效果
   - 使用 Flow 实现简单

### 已知问题

1. **大量食材筛选性能**
   - 影响：选择 20 个食材时，筛选可能变慢
   - 解决方案：使用索引、限制食材数量
   - 未来优化：使用全文搜索（FTS）

2. **组合筛选的索引优化**
   - 影响：多个条件组合时，可能无法有效使用索引
   - 解决方案：创建复合索引
   - 未来优化：使用更高级的索引策略

---

## References

- [REQUIREMENTS.md](../../../docs/REQUIREMENTS.md)
- [ARCHITECTURE.md](../../../docs/ARCHITECTURE.md)
- [Room Database - Querying](https://developer.android.com/training/data-storage/room/queries)
- [Kotlin Coroutines](https://kotlinlang.org/docs/coroutines-overview.html)

---

**文档版本**: 1.0
**创建日期**: 2026-02-20
**最后更新**: 2026-02-20
**负责人**: Jude 🦞
