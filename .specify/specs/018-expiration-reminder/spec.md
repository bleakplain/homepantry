# Spec: 保质期提醒

**Spec ID**: 018
**功能名称**: 保质期提醒
**优先级**: P2
**状态**: 🚧 规划中
**创建日期**: 2026-02-20
**最后更新**: 2026-02-20

---

## What

### 功能描述

保质期提醒功能允许用户设置食材过期提醒，避免浪费食材，帮助用户及时处理过期食材。

### 核心功能

#### 1. 过期提醒设置

**提醒配置**:
- 提前 N 天提醒（可配置）
- 提醒时间（可配置）
- 提醒频率（每日、提前 N 天）

**通知配置**:
- 通知渠道（系统通知）
- 通知声音（可选）
- 通知振动（可选）

#### 2. 批量检查过期食材

**检查功能**:
- 自动检查所有食材的过期状态
- 支持手动触发检查
- 检查结果统计

**状态分类**:
- 已过期（过期日期 < 今天）
- 即将过期（0 ≤ 过期日期 - 今天 ≤ N）
- 新鲜（过期日期 - 今天 > N）

#### 3. 通知管理

**通知功能**:
- 过期食材列表通知
- 单个食材过期通知
- 批量过期通知

**通知管理**:
- 查看历史通知
- 标记已处理通知
- 清除已处理通知

### 用户场景

#### 场景1：设置过期提醒

**触发条件**: 用户想避免食材过期浪费

**用户目标**: 提前收到过期提醒，及时处理

**当前痛点**: 需要手动检查每个食材的过期日期

**解决方案**:
1. 进入食材库存页面
2. 点击"过期提醒设置"
3. 设置提前提醒天数（3、5、7 天）
4. 设置提醒时间（每天早上 8 点）
5. 保存设置

**成功标准**:
- 设置保存成功
- 在指定时间收到提醒
- 提醒内容准确

#### 场景2：手动检查过期食材

**触发条件**: 用户想查看所有即将过期的食材

**用户目标**: 快速找到需要处理的食材

**当前痛点**: 需要逐个查看食材的过期日期

**解决方案**:
1. 进入食材库存页面
2. 点击"检查过期"
3. 查看过期报告
4. 批量处理过期食材

**成功标准**:
- 准确显示过期食材列表
- 可以批量操作
- 响应时间 < 500ms

#### 场景3：收到过期提醒

**触发条件**: 系统自动发送过期提醒

**用户目标**: 及时查看和处理过期食材

**当前痛点**: 可能错过食材过期

**解决方案**:
1. 收到系统通知
2. 打开通知，查看过期食材列表
3. 点击食材查看详情
4. 处理过期食材（使用或丢弃）

**成功标准**:
- 通知准时发送
- 通知内容准确
- 可以快速跳转到处理界面

---

## Why

### 业务价值

**对用户的价值**:
- 避免食材过期浪费
- 节省食材采购成本
- 提升食材管理效率

**对产品的价值**:
- 增加食材库存功能的使用价值
- 提升用户粘性
- 提供数据支持（过期食材统计）

### 问题解决

**解决的核心问题**:
1. 用户忘记食材过期日期
2. 食材过期造成浪费
3. 需要手动检查过期状态

**不解决的问题**:
- 不提供自动购买建议（由智能推荐功能解决）
- 不提供食材价格追踪（由财务管理功能解决）

### 成功指标

**功能性指标**:
- 过期提醒发送成功率: ≥ 99%
- 过期检查准确率: ≥ 98%
- 批量检查响应时间: < 1s

**性能指标**:
- 过期检查响应时间: < 500ms
- 1000 个食材检查: < 1s
- 10000 个食材检查: < 5s

**用户体验指标**:
- 过期提醒设置率: ≥ 60%
- 过期提醒打开率: ≥ 50%
- 过期食材处理率: ≥ 70%

---

## User Stories

### US-018-1: 作为用户，我想要设置过期提醒，以便提前收到过期通知

**验收标准**:
- [ ] 可以设置提前提醒天数（3、5、7 天）
- [ ] 可以设置提醒时间（每天早上 8 点）
- [ ] 可以设置通知声音和振动
- [ ] 设置保存成功

### US-018-2: 作为用户，我想要手动检查过期食材，以便查看需要处理的食材

**验收标准**:
- [ ] 可以手动触发过期检查
- [ ] 显示过期食材列表（已过期、即将过期、新鲜）
- [ ] 可以按过期时间排序
- [ ] 响应时间 < 500ms

### US-018-3: 作为用户，我想要批量处理过期食材，以便快速清理

**验收标准**:
- [ ] 可以批量标记为"已处理"
- [ ] 可以批量删除过期食材
- [ ] 可以批量记录使用记录
- [ ] 批量操作成功率 ≥ 99%

### US-018-4: 作为用户，我想要查看过期提醒历史，以便追踪过期情况

**验收标准**:
- [ ] 可以查看历史过期通知
- [ ] 可以标记为"已处理"
- [ ] 可以清除已处理通知
- [ ] 显示过期统计信息

### US-018-5: 作为用户，我想要自定义通知渠道，以便选择提醒方式

**验收标准**:
- [ ] 可以选择通知渠道（系统通知）
- [ ] 可以关闭通知
- [ ] 设置保存成功

---

## Non-Functional Requirements

### 性能

| 指标 | 要求 | 说明 |
|------|------|------|
| 过期检查响应时间 | < 500ms | 100 个食材 |
| 过期检查响应时间 | < 1s | 1000 个食材 |
| 过期检查响应时间 | < 5s | 10000 个食材 |
| 内存占用 | < 100MB | 检查操作 |

### 可用性

| 指标 | 要求 | 说明 |
|------|------|------|
| 过期提醒发送成功率 | ≥ 99% | 无数据丢失 |
| 过期检查准确率 | ≥ 98% | 与实际过期日期对比 |
| 批量操作成功率 | ≥ 99% | 批量标记/删除 |

### 兼容性

| 平台 | 最低版本 | 说明 |
|------|---------|------|
| Android | API 24 (Android 7.0) | 最小支持 |

---

## Constraints

### 技术约束

- **编程语言**: Kotlin 1.9+
- **数据库**: Room 2.6+
- **异步处理**: Coroutines + Flow
- **通知**: Android NotificationManager
- **定时任务**: WorkManager / AlarmManager
- **最低支持**: Android API 24

### 业务约束

- **提前提醒天数**: 1-30 天
- **提醒频率**: 每日、每周、每月
- **通知数量限制**: 单次最多 10 个食材

---

## Dependencies

### 依赖的其他功能

- **食材库存** (Spec 007): 需要食材数据和保质期信息
- **通知服务** (系统服务): 需要系统通知功能

### 被依赖的功能

- **智能推荐**: 基于过期食材提供推荐菜谱
- **购物清单**: 基于过期食材补充购物清单

---

## Out of Scope

### 不在本次实现的功能

- [ ] 自动生成购物清单
- [ ] 食材价格追踪
- [ ] 食材消耗统计
- [ ] 自动购买建议

### 未来可能的功能

- 自动生成购物清单（优先级 P2）
- 食材价格追踪（优先级 P3）
- 食材消耗统计（优先级 P3）

---

## Notes

### 设计决策

1. **为什么使用 WorkManager 而不是 AlarmManager？**
   - WorkManager 更现代，支持后台执行
   - 支持任务链和依赖
   - 支持电池优化

2. **为什么提前提醒天数限制在 1-30 天？**
   - 避免提醒时间过长
   - 避免过度打扰用户
   - 适合大部分食材的保质期

3. **为什么需要批量检查功能？**
   - 提升用户操作效率
   - 减少手动检查时间
   - 支持批量操作

### 已知问题

1. **批量检查性能**
   - 影响：10000 个食材时，检查可能变慢（5s）
   - 解决方案：使用分页检查、优化查询
   - 状态：✅ 已实现

2. **通知重复发送**
   - 影响：可能重复发送过期提醒
   - 解决方案：记录已发送的通知，避免重复
   - 状态：✅ 已实现

---

## References

- [REQUIREMENTS.md](../../../docs/REQUIREMENTS.md)
- [ARCHITECTURE.md](../../../docs/ARCHITECTURE.md)
- [WorkManager Guide](https://developer.android.com/topic/libraries/architecture/workmanager)
- [NotificationManager](https://developer.android.com/guide/topics/ui/notifiers/notifications)

---

**文档版本**: 1.0
**创建日期**: 2026-02-20
**最后更新**: 2026-02-20
**负责人**: Jude 🦞
